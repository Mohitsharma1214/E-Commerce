{% extends 'base.html' %}

{% block content %}
{% load cart %}
{% load custom_filter %}

<style>
    /* Custom CSS styles for the close button */
    
    .message-box {
        position: fixed;
        top: 90px;
        right: 20px;
        color: #ccc;
        background-color: black;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        padding: 10px 20px;
        border-radius: 5px;
        z-index: 999;
        animation: fadeIn 0.5s ease-out;
    }

    .btn-close {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: white;
    }

    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .loader-bar {
        width: 100%;
        height: 5px;
        background-color: #ccc;
        position: relative;
        border-radius: 5px;
        margin-top: 5px;
    }

    .loader-progress {
        width: 100%;
        height: 100%;
        background-color: #007bff;
        border-radius: 5px;
        position: absolute;
        top: 0;
        left: 0;
    }



    /* Custom CSS for resizing product images */
    .product-img-container {
        overflow: hidden;
        height: 400px;
    }

    .product-img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .card-img-container {
        overflow: hidden;
        height: 200px;
    }

    .card-img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    /* Custom CSS for the New Drops section */
    .new-drops-container {
        margin-top: 50px;
    }

    .new-drops-container h2 {
        margin-bottom: 20px;
        font-size: 24px;
        color: #333;
    }

    .new-drop-card {
        margin-bottom: 20px;
        border: 1px solid #ddd;
        border-radius: 5px;
        overflow: hidden;
        transition: box-shadow 0.3s ease;
    }

    .new-drop-card:hover {
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .new-drop-img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }

    .new-drop-card .card-body {
        padding: 15px;
    }

    .new-drop-card .card-title {
        margin-bottom: 10px;
        font-size: 18px;
    }

    .new-drop-card .card-text {
        color: #777;
    }

    .new-drop-card .btn-primary {
        background-color: #007bff;
        border-color: #007bff;
    }

    .new-drop-card .btn-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }
     /* Custom CSS styles for the product detail container */
     .product-container1 {
        padding: 20px;
        background-color: #f8f9fa;
        border-radius: 10px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        margin-left: 2em;
        text-align: center;
    }

    .product-image {
        width: 100%;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .product-details {
        padding-left: 20px;
    }

    .product-name {
        color: #333;
    }

    .product-price {
        color: #007bff;
        margin-bottom: 20px;
    }

    .product-description {
        color: #777;
    }

    .quantity-box {
        display: flex;
        align-items: center;
        margin-top: 10px;
    }

    .quantity-button {
        background-color: rgb(16, 5, 5);
        color: white;
        border: none;
        padding: 10px;
        border-radius: 5px;
        cursor: pointer;
        margin-right: 10px;
    }

    .quantity {
        background-color: #f8f9fa;
        padding: 10px;
        border-radius: 5px;
        font-weight: bold;
    }

    .quantity-button.disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* Additional styles for the buttons */
    .add-to-cart-btn {
        background-color: green;
    }

    .increase-btn {
        background-color: rgb(16, 5, 5);
    }

    .decrease-btn {
        background-color: rgb(16, 5, 5);
    }
    img.img-thumbnail {
  
   
  border: 1px solid;
  height: 90%;
  margin-top: 6px;
  
}
img.card-img-top {
    border: 1px solid black;
    border-radius: 3px;
    
}
.col-md-4 {
    margin-top: 1em;
    margin-bottom: 2em;
}
img.card-img {
    border: 1px solid black;
 }
 img.card-img-top {
    width: 100%;
    height: 130%;
}
h5.card-title {
    text-align: center;
}
p{
    text-align: center;
}
.text-center {
    text-align: center !important;
    margin-bottom: 6px;
}
.h2, h2 {
    font-size: 2rem;
    text-align: center;
    color: #7a6b6b;
}
.quantity-box {
    margin-left: 13.5em;
}
.product-name {
    color: #333;
    text-align: center;
}
.product-details .btn-block {
    display: flex;
    justify-content: center;
}

.quantity-box {
    display: flex;
    justify-content: center;
    margin-left: 10px;
    margin-bottom: 1em;
}

.quantity-button {
    margin: 0 5px; /* Adjust margin for better spacing */
}
img.card-img-top {
    border: 1px solid black;
    border-radius: 3px;
} 
@media (max-width: 767px) {
       .product-image{
        margin: 1.3em;
       }
    }

    .rating {
  font-size: 24px;
}

.star {
  cursor: pointer;
}

b, strong {
    font-weight: bolder;
    font-size: 25px;
}
.star:hover,
.star.active {
  color: orange;
}


.btn-block {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
}

.form-group {
    margin-bottom: 15px;
}





.size-option.selected {
    background-color: #007bff; /* Change background color of selected option */
    color: #fff; /* Change text color of selected option */
}
.size-option.selected:hover{
    background-color: #007bff;
    color: #fff;
}
.size-option {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 10px;
    margin: 6px;
    border: 1px solid #ccc;
    border-radius: 4px;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s; /* Add transition for background color and transform */
}

.size-option:hover {
    background-color: #555454;
}

.size-option:active {
    transform: translateY(2px); /* Move the box down slightly when clicked */
}
.btncart {
    position: relative;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
    color: white;
    color: black;
    transition: transform 0.3s ease-in-out; /* Add transition for smoother animation */
}
.btncart:hover{
    background-color:#555454 ;
    color: white;
}
.btncart:active {
    transform: scale(0.95); /* Scale down the button slightly when clicked */
    animation: breathe 1.5s infinite alternate; /* Add breathing animation */
}

@keyframes breathe {
    0% { transform: scale(1); }
    100% { transform: scale(1.02); } /* Adjust the scale value for the breathing effect */
}
/* Modal styles */
#myModal {
    display: none; /* Hide the modal by default */
    position: fixed; /* Position the modal fixed on the screen */
    top: 0; /* Position the modal at the top of the screen */
    left: 0; /* Position the modal at the left of the screen */
    width: 100%; /* Set the width to cover the entire screen */
    height: 100%; /* Set the height to cover the entire screen */
     /* Semi-transparent background to overlay the content */
    z-index: 9999; 
    /* Set a high z-index to ensure the modal appears on top of other content */
}

.modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: #fefefe;
    padding: 20px;
    border: 2px solid black;
    border-radius: 10px solid black;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-width: 239px;
    width: 103%;
    animation: fadeIn 0.5s ease;
}
@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}
/* Style for the "View in Cart" button */
.btn1 {
    display: block;
    width: 100%;
    padding: 10px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
    text-decoration: none;
}

.btn1:hover {
    background-color: #0056b3;
}
/* CSS for the modal content */
.modal-content {
    width: 70%; /* Adjust the width as needed */
    background-color: white; /* Set the background color to white */
    padding: 20px; /* Add padding for better appearance */
    border-radius: 10px; /* Add border-radius for rounded corners */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Add box-shadow for a subtle shadow effect */
}

/* Close button styles */
.close-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 24px;
    background-color: transparent;
    border: none;
    cursor: pointer;
    outline: none;
}


</style>
<!-- Include RateYo CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<!-- Include RateYo JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>

<!-- Include RateYo JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
<div id="myModal" class="modal">
    <div class="modal-content">
        <button class="close-btn">&times;</button> 
        <h2>Product Added</h2>
        <div>
            <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image1" style="width: 100%;">
            <p class="selected-size" style="font-size: 16px;">Size: <span id="selectedSize"></span></p>
        </div>
        <input type="hidden" id="size-id-input" name="size_id">
        <p class="product-name1" style="font-size: 19px; margin-top: 2px;">{{ product.name }}</p>
        <button id="viewCartBtn" class="btn1">View in Cart</button>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-md-12 product-container1">
            <div class="row">
                <div class="col-md-6">
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image">
                </div>
                <div class="col-md-6 product-details" style="margin-top: 70px;">
                    <h3 style="color: grey;margin-top: -3em;margin-bottom: -1.5em;">TeArt</h3>
                    <h1 class="product-name" style="font-size: 40px; margin-top: 50px;"><b>{{ product.name }}</b></h1>
                    <p class="product-price" style="font-weight: normal;">
                        <del>{{ product.deleted_price|currency}}</del> {{ product.price|currency}}
                    </p>
                    
                    <div class="d-flex justify-content-center align-items-center"> <!-- Use Flexbox to center the buttons -->
                        {% if product|cart_quantity:request.session.cart == 0 %}
                            <!-- Display "Add to Cart" button if product quantity is 0 in cart -->
                            <div class="form-container">
                                <form id="addToCartForm" action="{% url 'increase-cart' %}" method="POST" class="btn-block">
                                    {% csrf_token %}
                                    <input type="hidden" name="product_id" value="{{ product.id }}">
                                    <input type="hidden" name="action" value="increase">
                                    <input type="hidden" name="next" value="{{ request.path }}">
                                    
                                    <!-- Add a dropdown menu for selecting the size -->
                                    <div class="form-group">
                                        <label for="size">Select Size:</label>
                                        <div class="size-container">
                                            {% if sizes %}
                                                {% for size in sizes %}
                                                    <div class="size-option" data-value="{{ size.id }}">{{ size.name }}</div>
                                                {% endfor %}
                                            {% else %}
                                                <div class="size-option" disabled>No sizes available for this product.</div>
                                            {% endif %}
                                        </div>
                                        <input type="hidden" name="size" id="size-input">
                                    </div>
                                    
                                    <div class="form-group" style="margin-left: 2em;">
                                        <input type="submit" id="addToCartBtn" class="form-control btncart" value="Add To Cart">
                                    </div>
                                  </form>
                                
                                
                                  <!-- Modal -->
                                
                                
                                
                                
                                
                                                            </div>
                            
                        {% else %}
                            <!-- Display quantity box if product quantity is not 0 in cart -->
                            <div class="quantity-box" data-product-id="{{ product.id }}">
                                {% if request.session.cart %}
                                <div class="row no-gutters">
                                    <form action="{% url 'increase-cart' %}" method="POST" class="btn-block">
                                        {% csrf_token %}
                                        <input type="hidden" name="product_id" value="{{ product.id }}">
                                        <input type="hidden" name="action" value="increase">
                                        <input type="hidden" name="next" value="{{ request.path }}">
                                        
                                        <!-- Add a dropdown menu for selecting the size -->
                                        <div class="form-group">
                                            <label for="size">Select Size:</label>
                                            <div class="size-container">
                                                {% if sizes %}
                                                    {% for size in sizes %}
                                                        <div class="size-option" data-value="{{ size.id }}">{{ size.name }}</div>
                                                    {% endfor %}
                                                {% else %}
                                                    <div class="size-option" disabled>No sizes available for this product.</div>
                                                {% endif %}
                                            </div>
                                            <input type="hidden" name="size" id="size-input">
                                        </div>
                                        
                                        <div class="form-group" style="margin-left: 1em;">
                                            <input type="submit" class="form-control btncart" value="Add To Cart">
                                        </div>
                                    </form>
                                                                    </div>
                                {% else %}
                                    <!-- Fallback behavior when cart data is not available -->
                                     <!-- or any default quantity -->
                                    <!-- Optionally, you can provide a message to inform the user -->
                                    <p><form action="{% url 'increase-cart' %}" method="POST" class="btn-block">
                                        {% csrf_token %}
                                        <input type="hidden" name="product_id" value="{{ product.id }}">
                                        <input type="hidden" name="action" value="increase">
                                        <input type="hidden" name="next" value="{{ request.path }}">
                                        
                                        <!-- Add a dropdown menu for selecting the size -->
                                        <div class="form-group">
                                            <label for="size">Select Size:</label>
                                            <div class="size-container">
                                                {% if sizes %}
                                                    {% for size in sizes %}
                                                        <div class="size-option" data-value="{{ size.id }}">{{ size.name }}</div>
                                                    {% endfor %}
                                                {% else %}
                                                    <div class="size-option" disabled>No sizes available for this product.</div>
                                                {% endif %}
                                            </div>
                                            <input type="hidden" name="size" id="size-input">
                                        </div>
                                        
                                        <div class="form-group" style="margin-left: 2em;">
                                            <input type="submit" class="form-control btncart" value="Add To Cart">
                                        </div>
                                    </form>                                    
                                                                        
                                    
                                    </p>
                                {% endif %}
                            </div>
                            
                        {% endif %}
                    </div>
                    {% if product.description %}
                        <p class="product-description">{{ product.description | safe }}</p>
                    {% else %}
                        <p class="product-description">No description available</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>


<div class="container mt-5">
    <h2 class="text-center">Related Products</h2>
    <hr>
    <div class="row row justify-content-center" style="margin-left: .2em;">
        {% for related_product in related_products %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card">
                    
                    <a href="{% url 'product-detail'  related_product.id %}" style="color: black; text-align: center;">
                        <img class="card-img-top" src="{{  related_product.image.url }}" alt="Card image cap" style="max-height: 150px; max-width: 150px; ">
                    </a>
                    <div class="card-body">
                        <h5 class="card-title">{{ related_product.name }}</h5>
                        <p class="card-text">
                            <span class="regular-price">{{ related_product.price|currency }}</span>
                            <span class="deleted-price"> <del> {{ related_product.deleted_price|currency }} </del></span>
                        </p>
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12 text-center" style="margin-left: 1.5em;" > <!-- Added text-center class to center-align the button -->
                                    <a href="{% url 'product-detail' related_product.id %}" class="btn btndet" style="color: white; background-color: rgb(36, 34, 34);">View Details</a>
                                </div>
                                <div class="">
                                    {% if related_product|cart_quantity:request.session.cart == 0 %}
                                        <!-- Display "Add to Cart" button if product quantity is 0 in cart -->
                                                                                
                                    {% else %}
                                        
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>


<!-- New drops -->
<div class="container mt-5">
    <h2 class="text-center">New Drops</h2>
    <hr>
    <div class="row row justify-content-center" style="margin-left: .2em;">
        {% for new_drop in new_drops %}
            <div class="col-lg-4 col-md-6 mb-4">
                <div class="card">
                    <a href="{% url 'product-detail'  new_drop.id %}" style="color: black; text-align: center;">
                        <img class="card-img-top" src="{{  new_drop.image.url }}" alt="Card image cap" style="max-height: 150px; max-width: 150px; ">
                    </a>
                    <div class="card-body">
                        <h5 class="card-title">{{ new_drop.name }}</h5>
                        <p class="card-text">
                            <span class="regular-price">{{ new_drop.price|currency }}</span>
                            <span class="deleted-price"> <del>{{ new_drop.deleted_price|currency }} </del></span>
                        </p>
                        <div class="container">
                            <div class="row">
                                <div class="col-md-12 text-center" style="margin-left: 1.5em;"> <!-- Added text-center class to center-align the button -->
                                    <a href="{% url 'product-detail' new_drop.id %}" class="btn btndet" style="color: white; background-color: rgb(36, 34, 34);">View Details</a>
                                </div>
                                <div class="">
                                    {% if new_drop|cart_quantity:request.session.cart == 0 %}
                                        <!-- Display "Add to Cart" button if product quantity is 0 in cart -->
                                        
                                    {% else %}
                                        
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

{% for message in messages %}
    {% if message.tags == 'error' %}
        {% if 'log in' in message %}
            <div class="alert alert-danger text-center" role="alert">
                {{ message | safe }}
                <a href="{% url 'login' %}" class="alert-link">Log in</a>
            </div>
        {% else %}
            <div class="alert alert-danger text-center" role="alert">
                {{ message | safe }}
            </div>
        {% endif %}
    {% else %}
        <div class="alert alert-success text-center" role="alert">
            {{ message | safe }}
        </div>
    {% endif %}
{% endfor %}

<div class="container">
    <div class="row">
        <div class="col-md-6">
            <!-- Product Review Form -->
            <div class="product-review">
                <h2>Leave a Review</h2>
                <form id="review-form" method="POST" action="{% url 'submit_review' %}">
                    {% csrf_token %}
                    <input type="hidden" name="product_id" value="{{ product.id }}">
                    <!-- Display stars for users to rate -->
                    <div class="rating" data-rating="0">
                        <span class="star" data-value="1">&#9733;</span>
                        <span class="star" data-value="2">&#9733;</span>
                        <span class="star" data-value="3">&#9733;</span>
                        <span class="star" data-value="4">&#9733;</span>
                        <span class="star" data-value="5">&#9733;</span>
                    </div>
                    <!-- Hidden input to store the selected rating -->
                    <input type="hidden" name="rating" id="rating_input">
                    <div class="form-group">
                        <label for="comment">Comment:</label>
                        <textarea class="form-control" name="comment" id="comment" rows="4" cols="50"></textarea>
                    </div>
                    <!-- Display customer's name if logged in -->
                    {% if user.is_authenticated %}
                        <p>Review submitted by: {{ user.customer.first_name }} {{ user.customer.last_name }}</p>
                    {% endif %}
                    <button type="submit" class="btn btn-primary">Submit Review</button>
                </form>
            </div>
        </div>
        <div class="col-md-6">
            <!-- Product Reviews Section -->
            <div class="product-reviews">
                <h2>Product Reviews</h2>
                {% if reviews %}
                    <ul class="list-group">
                        <li class="list-group-item">
                            <strong>Average Rating:</strong> 
                            {% if avg_rating %}
                                {% for _ in "x"|ljust:num_stars %}
                                    <span class="star">&#9733;</span>
                                {% endfor %}
                            {% else %}
                                No ratings yet
                            {% endif %}
                            {{ avg_rating|default:"" }} / 5.0
                        </li>
                        {% for review in reviews %}
                            <li class="list-group-item">
                                <strong>Reviewer:</strong> {{ review.customer.first_name }} {{ review.customer.last_name }}
                                <br>

                                <strong>Rating:</strong>
                                {% for _ in "x"|ljust:review.rating %}
                                    <span class="star">&#9733;</span>
                                {% endfor %}
                               
                                
                                <br>
                                <strong>Comment:</strong> {{ review.comment }}
                                                            </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>No reviews yet.</p>
                {% endif %}
            </div>
        </div>
</div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/rateYo/2.3.2/jquery.rateyo.min.css">

<script>
    jQuery.noConflict();
    function closeMessage(messageBox) {
        $(messageBox).css('display', 'none'); // Hide the message box
    }

        // Function to display floating message
        function showMessage(message) {
            var $messageBox = $('<div class="message-box">' +
                '<button type="button" class="btn-close" onclick="closeMessage(this.parentElement)"></button>' + // Close button
                '<div class="message">' + message + '</div>' + // Message content
                '<div class="loader-bar"><div class="loader-progress"></div></div>' + // Loader bar
                '</div>'); // Create message box element
            $('body').append($messageBox); // Append message box to body
            setTimeout(function() {
                $messageBox.fadeOut(); // Fade out message box after some time
            }, 5000); // Adjust timing as needed
            startTimer($messageBox.find('.loader-progress')); // Start timer for loader
        }

        // Function to start the timer for the loader
        function startTimer($loaderProgress) {
            var width = 100; // Initial width of loader bar

            // Update loader bar width every 100ms
            var timer = setInterval(function() {
                width -= 1; // Decrease width by 1%
                $loaderProgress.width(width + '%');

                // If loader bar width reaches 0, clear the interval
                if (width <= 0) {
                    clearInterval(timer);
                }
            }, 50); // Adjust timing as needed
        }

        // Function to retrieve CSRF token
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Check if the cookie name matches the specified name
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        document.addEventListener("DOMContentLoaded", function() {
    const stars = document.querySelectorAll(".rating .star");
    const ratingContainer = document.querySelector(".rating");
    const ratingInput = document.getElementById('rating_input');
    const form = document.getElementById('review-form');

    // Set initial rating based on data attribute
    const ratingValue = ratingContainer.getAttribute("data-rating");
    setRating(ratingValue);

    // Add event listeners to stars
    stars.forEach(star => {
        star.addEventListener("click", () => {
            const value = star.getAttribute("data-value");
            ratingInput.value = value; // Update the hidden input value
            setRating(value);
        });
        star.addEventListener("mouseover", () => {
            const value = star.getAttribute("data-value");
            highlightStars(value);
        });
        star.addEventListener("mouseout", () => {
            const currentValue = ratingContainer.getAttribute("data-rating");
            highlightStars(currentValue);
        });
    });

    // Function to set the rating
    function setRating(value) {
        ratingContainer.setAttribute("data-rating", value);
        highlightStars(value);
        // You can send an AJAX request to update the rating on the server here
    }

    // Function to highlight stars up to a given value
    function highlightStars(value) {
        stars.forEach(star => {
            if (star.getAttribute("data-value") <= value) {
                star.classList.add("active");
            } else {
                star.classList.remove("active");
            }
        });
    }

    // Add form submission event listener
    form.addEventListener('submit', function(event) {
        // Prevent form submission if no rating is selected
        if (ratingInput.value === '') {
            alert('Please select a rating.');
            event.preventDefault();
        }
    });
});

  // Function to reset all stars
  function resetStars() {
    const currentValue = ratingContainer.getAttribute("data-rating");
    highlightStars(currentValue);
  }

  jQuery.noConflict();
         function closeMessage(messageBox) {
    $(messageBox).css('display', 'none'); // Hide the message box
}

    jQuery(document).ready(function($) {
        // Function to handle AJAX requests for updating cart quantity
        $('.quantity-button').click(function() {
            var $quantityBox = $(this).closest('.quantity-box');
            var productId = $quantityBox.data('product-id'); // Retrieve product ID from data-product-id attribute
            var action = $(this).data('action');
            var $quantity = $quantityBox.find('.quantity');
            var currentQuantity = parseInt($quantity.text());

            // Ensure that currentQuantity is a valid number
            if (isNaN(currentQuantity)) {
                currentQuantity = 0;
            }

            // Adjust the quantity based on the action
            if (action === 'increase') {
                currentQuantity += 1;
            } else if (action === 'decrease' && currentQuantity > 1) {
                currentQuantity -= 1 ;
            }

            // Update the UI with the new quantity
            $quantity.text(currentQuantity + ' in Cart');

            // Make AJAX request to update the cart
            $.ajax({
                url: "/increase-cart",
                type: "POST",
                headers: {
                    "X-CSRFToken": getCookie("csrftoken")
                },
                data: {
                    'product_id': productId, // Send the correct product ID in the AJAX request
                    'action': action
                },
                success: function(response) {
                    try {
                        if (response && typeof response === 'object') {
                            // Update the cart quantity displayed on the page
                            if ('cart_quantity' in response) {
                                $quantity.text(response.cart_quantity);
                            } else {
                                console.error("Invalid response format: Missing cart_quantity field");
                            }

                            // Display messages from the response
                            if ('messages' in response) {
                                response.messages.forEach(function(message) {
                                    showMessage(message);
                                });
                            } else {
                                console.error("Invalid response format: Missing messages field");
                            }
                        } else {
                            console.error("Invalid response format: Response is not an object");
                        }
                    } catch (e) {
                        console.error("Error parsing JSON response:", e);
                    }
                },
                error: function(xhr, status, error) {
                    console.error("AJAX request error:", error);
                }
            });
        });

        // Function to display floating message
        function showMessage(message) {
            var $messageBox = $('<div class="message-box">' +
                '<button type="button" class="btn-close" onclick="closeMessage(this.parentElement)"></button>' + // Close button
                '<div class="message">' + message + '</div>' + // Message content
                '<div class="loader-bar"><div class="loader-progress"></div></div>' + // Loader bar
                '</div>'); // Create message box element
            $('body').append($messageBox); // Append message box to body
            setTimeout(function() {
                $messageBox.fadeOut(); // Fade out message box after some time
            }, 5000); // Adjust timing as needed
            startTimer($messageBox.find('.loader-progress')); // Start timer for loader
        }

        // Function to start the timer for the loader
        function startTimer($loaderProgress) {
            var width = 100; // Initial width of loader bar

            // Update loader bar width every 100ms
            var timer = setInterval(function() {
                width -= 1; // Decrease width by 1%
                $loaderProgress.width(width + '%');

                // If loader bar width reaches 0, clear the interval
                if (width <= 0) {
                    clearInterval(timer);
                }
            }, 50); // Adjust timing as needed
        }

        // Function to retrieve CSRF token
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = cookies[i].trim();
                    // Check if the cookie name matches the specified name
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });

    // JavaScript for message box functionality
    document.addEventListener('DOMContentLoaded', function () {
    const messageBox = document.getElementById('message-box');
    if (messageBox) {
        messageBox.style.display = 'block'; // Show message box
        startTimer(); // Start timer for message box
    }
});

// Function to close the message box
function closeMessage() {
    const messageBox = document.getElementById('message-box');
    if (messageBox) {
        messageBox.style.display = 'none'; // Hide message box
    }
}

// Function to start the timer for the message box
function startTimer() {
    const loaderProgress = document.getElementById('loader-progress');
    let width = 100; // Initial width of loader bar

    // Update loader bar width every 100ms
    const timer = setInterval(function () {
        width -= 1; // Decrease width by 1%
        loaderProgress.style.width = width + '%';

        // If loader bar width reaches 0, close the message box
        if (width <= 0) {
            clearInterval(timer);
            closeMessage();
        }
    }, 15); // Adjust timing as needed
}
// Function to add fade-in class to elements
function fadeInElements() {
    const elements = document.querySelectorAll('.fade-in');
    elements.forEach(element => {
        element.classList.add('fade-in'); // Add fade-in class to trigger animation
    });
}

// Trigger fade-in effect when the page loads
document.addEventListener('DOMContentLoaded', function() {
    fadeInElements();
});
document.addEventListener('DOMContentLoaded', function () {
        const messageBox = document.getElementById('message-box');
        if (messageBox) {
            setTimeout(() => {
                messageBox.classList.remove('active');
            }, 5000); // Adjust timing as needed
        }
    });

    // Function to remove the active class after fade-in animation
    document.addEventListener('animationend', function(event) {
        const target = event.target;
        if (target.classList.contains('fade-in')) {
            target.classList.remove('active');
        }
    });
    function showModal(message, cartLink, selectedSize) {
    // Update modal content
    $('#successMessage').text(message);
    $('#cartLink').attr('href', cartLink);
    $('#selectedSize').text(selectedSize); // Set selected size in modal
    // Show modal
    $('#myModal').modal('show');
}

$(document).ready(function() {
    // Handle AJAX response to show modal
    $(document).ajaxComplete(function(event, xhr, settings) {
        // Check if the response is JSON
        var contentType = xhr.getResponseHeader('Content-Type');
        if (contentType && contentType.indexOf('application/json') !== -1) {
            var data = JSON.parse(xhr.responseText);
            if (data.success) {
                showModal(data.message, data.cart_link);
                
                // Update selected size
                var selectedSize = $('#size-input').val();
                $('#selectedSize').text(selectedSize);
            }
        }
    });
});

document.addEventListener("DOMContentLoaded", function() {
  const sizeOptions = document.querySelectorAll(".size-option");
  const hiddenInput = document.getElementById("size-input");

  // Function to select the default size option
  function selectDefaultSize() {
    // Loop through the size options
    sizeOptions.forEach(function(option) {
      // Check if the option's text content is "Size S" or if it's the first option
      if (option.textContent.trim() === "Size S" || option === sizeOptions[0]) {
        // Add 'selected' class to the option
        option.classList.add("selected");
        // Set the hidden input value to the selected size ID
        hiddenInput.value = option.dataset.value;
      }
    });
  }

  // Call the function to select the default size option upon page load
  selectDefaultSize();

  // Event listener to handle size option selection
  sizeOptions.forEach(function(option) {
    option.addEventListener("click", function() {
      // Remove 'selected' class from previously selected option
      document.querySelector(".size-option.selected")?.classList.remove("selected");
      // Add 'selected' class to the clicked option
      this.classList.add("selected");

      const selectedSizeId = this.dataset.value;
      hiddenInput.value = selectedSizeId;
    });
  });
});

var modal = document.getElementById("myModal");

    // Get the form
    var form = document.getElementById("addToCartForm");

    // When the form is submitted, prevent the default behavior and show the modal
   

    // Functionality for "View in Cart" button
    var viewCartBtn = document.getElementById("viewCartBtn");
    viewCartBtn.onclick = function() {
        // Your code to handle viewing the cart
        window.location.href = "{% url 'cart' %}";
    }
    $(document).ready(function() {
        // Get the modal
        var modal = $("#myModal");

        // Intercept form submission
        $("#addToCartForm").submit(function(event) {
            event.preventDefault();
            // Send AJAX request
            $.ajax({
                url: $(this).attr('action'),
                type: $(this).attr('method'),
                data: $(this).serialize(),
                success: function(response) {
                    // Show the modal
                    modal.show();
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        });

        // Functionality for "View in Cart" button
        $("#viewCartBtn").click(function() {
            // Redirect to the cart page
            window.location.href = "{% url 'cart' %}";
        });

        // Close the modal when the user clicks outside of it
        $(window).click(function(event) {
            if (event.target == modal[0]) {
                modal.hide();
            }
        });
    });
    // Get the form
    var form = document.getElementById("addToCartForm");

// When the form is submitted, set the value of the hidden input field to the selected size ID
form.addEventListener("submit", function(event) {
    // Get the selected size option
    var selectedSizeOption = document.querySelector(".size-option.selected");
    // Check if a size option is selected
    if (selectedSizeOption) {
        // Get the value (size ID) from the dataset of the selected size option
        var selectedSizeId = selectedSizeOption.dataset.value;
        // Get the size name from the selected size option
        var selectedSizeName = selectedSizeOption.textContent.trim();
        // Set the value of the hidden input field to the selected size ID
        document.getElementById("size-input").value = selectedSizeId;
        // Set the text content of the span to the selected size name
        document.getElementById("selectedSize").textContent = selectedSizeName;
        console.log(selectedSizeId);
    }
    // If no size option is selected, prevent the form submission
    else {
        event.preventDefault();
        alert("Please select a size.");
    }
});

// Get the close button element
var closeBtn = document.querySelector('.close-btn');

// Add click event listener to close the modal when close button is clicked
closeBtn.addEventListener('click', function() {
    // Hide the modal
    var modal = document.getElementById('myModal');
    modal.style.display = 'none';
});
document.addEventListener("DOMContentLoaded", function() {
    // Code to attach event listener to the form
    var form = document.getElementById("addToCartForm");
    if (form) {
        form.addEventListener("submit", function(event) {
            // Your form submission logic here
        });
    } else {
        console.error("Form element with ID 'addToCartForm' not found.");
    }
});


</script>

{% endblock %}
